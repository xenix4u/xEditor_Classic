<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xEditor Initialization Test</title>
    <link rel="stylesheet" href="xeditor.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #editor {
            min-height: 300px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 20px;
        }
        .error {
            color: #e74c3c;
            background: #ffe0e0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: #27ae60;
            background: #e0ffe0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>xEditor Initialization Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Check Library Loading</h2>
        <div id="library-check"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Initialize Editor</h2>
        <div id="editor">
            <p>This is a test paragraph.</p>
        </div>
        <div id="init-result"></div>
    </div>

    <div class="test-section">
        <h2>Console Output</h2>
        <pre id="console-output"></pre>
    </div>

    <script src="xeditor.min.js"></script>
    <script>
        // Custom console logging
        const consoleOutput = document.getElementById('console-output');
        const originalLog = console.log;
        const originalError = console.error;
        
        function logToPage(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToPage(args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logToPage(args.join(' '), 'error');
        };

        // Test 1: Check library loading
        window.addEventListener('DOMContentLoaded', function() {
            const libraryCheck = document.getElementById('library-check');
            
            console.log('Checking xEditor availability...');
            
            // Check different possible ways the library might be exposed
            const checks = [
                { name: 'window.xEditor', value: window.xEditor },
                { name: 'window.xeditor', value: window.xeditor },
                { name: 'window.XEditor', value: window.XEditor },
                { name: 'globalThis.xEditor', value: globalThis.xEditor },
                { name: 'xEditor (global)', value: typeof xEditor !== 'undefined' ? xEditor : undefined }
            ];
            
            let foundEditor = false;
            checks.forEach(check => {
                if (check.value) {
                    libraryCheck.innerHTML += `<div class="success">✓ Found: ${check.name} = ${typeof check.value}</div>`;
                    console.log(`Found ${check.name}:`, check.value);
                    foundEditor = true;
                } else {
                    libraryCheck.innerHTML += `<div>✗ Not found: ${check.name}</div>`;
                }
            });
            
            if (!foundEditor) {
                libraryCheck.innerHTML += `<div class="error">xEditor library not found in any expected location!</div>`;
            }
            
            // Test 2: Try to initialize editor
            const initResult = document.getElementById('init-result');
            
            try {
                console.log('Attempting to initialize xEditor...');
                
                // Try different initialization methods
                let editor = null;
                let initMethod = '';
                
                if (window.xEditor) {
                    editor = new xEditor('#editor', {
                        toolbar: {
                            items: ['bold', 'italic', 'underline', '|', 'link', 'image']
                        }
                    });
                    initMethod = 'new xEditor()';
                } else if (window.xeditor) {
                    // Try lowercase
                    if (typeof window.xeditor === 'function') {
                        editor = new window.xeditor('#editor', {
                            toolbar: {
                                items: ['bold', 'italic', 'underline', '|', 'link', 'image']
                            }
                        });
                        initMethod = 'new window.xeditor()';
                    } else if (window.xeditor.default) {
                        editor = new window.xeditor.default('#editor', {
                            toolbar: {
                                items: ['bold', 'italic', 'underline', '|', 'link', 'image']
                            }
                        });
                        initMethod = 'new window.xeditor.default()';
                    }
                }
                
                if (editor) {
                    initResult.innerHTML = `<div class="success">✓ Editor initialized successfully using: ${initMethod}</div>`;
                    console.log('Editor initialized successfully!', editor);
                    
                    // Test editor methods
                    if (editor.on) {
                        editor.on('ready', () => {
                            console.log('Editor ready event fired!');
                            initResult.innerHTML += `<div class="success">✓ Editor ready event received</div>`;
                        });
                    }
                } else {
                    throw new Error('Could not find a valid xEditor constructor');
                }
            } catch (error) {
                initResult.innerHTML = `<div class="error">✗ Failed to initialize editor: ${error.message}</div>`;
                console.error('Initialization error:', error);
                console.error('Stack trace:', error.stack);
            }
        });
    </script>
</body>
</html>